#!/bin/bash
#SBATCH --job-name=convert_gtex
#SBATCH --time=12:00:00
#SBATCH --partition=shared
#SBATCH --nodes=1
# number of tasks (processes) per node
#SBATCH --ntasks-per-node=1
## For GNU-Parallel, we won't be needing job arrays
##SBATCH --array=1-10%10
#SBATCH --output=/scratch/users/rmccoy22@jhu.edu/logs/slurm-%A_%a.out

#### load and unload modules you may need
ml samtools
# GNU-Parallel
ml parallel

# start timestamp
date

echo "Text read from file: $line"
## Some sra-toolkit executables will be found in this directory
cd /scratch/users/rmccoy22@jhu.edu/dbgap/sra

# Store the .sra files in an array
sra="*.sra"
files=( $sra )

# Convert from .sra to .bam
	parallel --delay .2 -j 4 --joblog logs/runtask.log --resume "./sam-dump ${files[@]} |\
		samtools view -bS - > ${files[@]}.bam"

echo "Finished with job $SLURM_ARRAY_TASK_ID"
# end timestamp
date